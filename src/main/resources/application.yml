server:
  port: 8080
  shutdown: graceful
  netty:
    connection-timeout: 2s
    idle-timeout: 15s

spring:
  application:
    name: ai-powered-market-intelligence
  
  main:
    allow-bean-definition-overriding: true
  
  profiles:
    active: ${SPRING_PROFILES_ACTIVE:dev}
  
  r2dbc:
    url: ${DATABASE_URL:r2dbc:h2:mem:///aiagentsystem}
    username: ${DATABASE_USERNAME:sa}
    password: ${DATABASE_PASSWORD:}
    pool:
      initial-size: ${DB_POOL_INITIAL:10}
      max-size: ${DB_POOL_MAX:50}
      max-idle-time: 30m
      validation-query: SELECT 1
  
  sql:
    init:
      mode: always
  
  data:
    redis:
      enabled: ${REDIS_ENABLED:false}
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6379}
      password: ${REDIS_PASSWORD:}
      timeout: 2000ms
      lettuce:
        pool:
          max-active: 20
          max-idle: 10
          min-idle: 2
          max-wait: 2000ms
  
  security:
    jwt:
      secret: ${JWT_SECRET:mySecretKey123456789012345678901234567890}
      expiration: ${JWT_EXPIRATION:86400000}
  
  lifecycle:
    timeout-per-shutdown-phase: 30s

# Enterprise Monitoring & Observability
management:
  endpoints:
    web:
      exposure:
        include: "*"
      base-path: /actuator
  endpoint:
    health:
      show-details: always
      probes:
        enabled: true
    metrics:
      enabled: true
    prometheus:
      enabled: true
  metrics:
    export:
      prometheus:
        enabled: true
    distribution:
      percentiles-histogram:
        http.server.requests: true
      percentiles:
        http.server.requests: 0.5, 0.95, 0.99
  tracing:
    sampling:
      probability: ${TRACING_SAMPLE_RATE:0.1}
    zipkin:
      endpoint: ${ZIPKIN_ENDPOINT:http://localhost:9411/api/v2/spans}

# Circuit Breaker Configuration
resilience4j:
  circuitbreaker:
    instances:
      marketData:
        register-health-indicator: true
        sliding-window-size: 10
        minimum-number-of-calls: 5
        permitted-number-of-calls-in-half-open-state: 3
        wait-duration-in-open-state: 30s
        failure-rate-threshold: 50
      aiService:
        register-health-indicator: true
        sliding-window-size: 20
        minimum-number-of-calls: 10
        wait-duration-in-open-state: 60s
        failure-rate-threshold: 60
  retry:
    instances:
      default:
        max-attempts: 3
        wait-duration: 1s
        exponential-backoff-multiplier: 2
  ratelimiter:
    instances:
      api:
        limit-for-period: 100
        limit-refresh-period: 1s
        timeout-duration: 0s

# API Documentation
springdoc:
  api-docs:
    path: /api-docs
  swagger-ui:
    path: /swagger-ui.html
    operations-sorter: method
  info:
    title: AI-Powered Market Intelligence API
    description: Enterprise-grade AI-powered market intelligence system for financial analysis
    version: 1.0.0
    contact:
      name: AI Agent System Team
      email: support@aiagentsystem.com

# Enterprise Logging
logging:
  level:
    com.example.aiagentsystem: ${LOG_LEVEL:INFO}
    org.springframework.r2dbc: WARN
    io.r2dbc.postgresql: WARN
    org.springframework.security: WARN
    reactor.netty: WARN
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level [%X{traceId:-},%X{spanId:-}] %logger{36} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level [%X{traceId:-},%X{spanId:-}] %logger{36} - %msg%n"
  file:
    name: ${LOG_FILE:logs/ai-agent-system.log}
    max-size: 100MB
    max-history: 30

# Application Configuration
app:
  security:
    cors:
      allowed-origins: ${CORS_ORIGINS:http://localhost:3000,http://localhost:8080}
      allowed-methods: GET,POST,PUT,DELETE,OPTIONS
      allowed-headers: "*"
      allow-credentials: true
  rate-limiting:
    enabled: ${RATE_LIMITING_ENABLED:true}
    requests-per-minute: ${RATE_LIMIT_RPM:1000}
  cache:
    ttl: ${CACHE_TTL:300}
  websocket:
    max-connections: ${WS_MAX_CONNECTIONS:1000}
    heartbeat-interval: ${WS_HEARTBEAT:30s}

---
spring:
  config:
    activate:
      on-profile: prod
  r2dbc:
    url: ${DATABASE_URL:r2dbc:postgresql://localhost:5432/aiagentsystem}
    username: ${DATABASE_USERNAME:aiagent}
    password: ${DATABASE_PASSWORD:}
  data:
    redis:
      enabled: true

logging:
  level:
    com.example.aiagentsystem: INFO
    root: WARN

management:
  tracing:
    sampling:
      probability: 0.01

---
spring:
  config:
    activate:
      on-profile: test
  r2dbc:
    url: r2dbc:h2:mem:///test
  data:
    redis:
      enabled: false

logging:
  level:
    com.example.aiagentsystem: DEBUG